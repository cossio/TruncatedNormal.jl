using Test, TruncatedNormal

@testset "moments" begin
    @test tnmean(100, 115) ≈ 100.00999800099926070518490239457545847490332879043
    @test tnvar(50, 70) ≈ 0.0003990431868038995479099272265360593305365
    @test tnmean(50, 70, -2, 3) ≈ 50.171943499898757645751683644632860837133138152489
    @test tnvar(50, 70, -2, 3) ≈ 0.029373438107168350377591231295634273607812172191712
    @test tnmean(-100.0, 0.0, 0.0, 2.0986317998643735) ≈ -1.6744659119217125058885983754999713622460154892645
    @test tnvar(-100.0, 0.0, 0.0, 2.0986317998643735) ≈ 1.6004193412141677189841357987638847137391508803335
    @test tnmean(0.0, 0.9, 0.0, 0.07132755843183151) ≈ 0.056911157632522598806524588414964004271754161737065
    @test tnvar(0.0, 0.9, 0.0, 0.07132755843183151) ≈ 0.0018487407287725028827020557707636415445504260892486
    @test tnmean(-100.0, 100.0, 0.0, 17.185261847875548) ≈ 0
    @test tnvar(-100.0, 100.0, 0.0, 17.185261847875548) ≈ 295.333163899557735486302841237124507431445
    @test tnmean(-100.0, 0.5, 0.0, 0.47383322897860064) ≈ -0.1267981330521791493635176736743283314399
    @test tnvar(-100.0, 0.5, 0.0, 0.47383322897860064) ≈ 0.145041095812679283837328561547251019229612
    @test tnmean(-100.0, 100.0, 0.0, 17.185261847875548) ≈ 0
    @test tnvar(-100.0, 100.0, 0.0, 17.185261847875548) ≈ 295.333163899557735486302841237124507431445

    @test tnmean(-10000., 10000., 0., 1.) ≈ 0
    @test tnvar(-10000., 10000., 0., 1.) ≈ 1

    @test tnmean(-1e6, -999000) ≈ -999000.00000100100100099899498898098
    @test tnmean(-1e6, -999000) == tnmom1(-1e6, -999000)
    @test tnmom2(-1e6, -999000) ≈ 9.9800100000199999999999799599399200002e11
    @test_broken tnvar(-1e6, -999000) ≈ 1.00200300399898194688784897455e-12
end

@testset "moments (infinite ranges)" begin
    @test tnmean(-Inf, Inf) == tnmean(-Inf, Inf, 0, 1) == 0
    @test tnvar(-Inf, Inf) == tnvar(-Inf, Inf, 0, 1)  == 1

    @test tnmean(0, Inf) == tnmean(0, Inf, 0, 1) ≈ √(2/π)
    @test tnmean(-Inf, 0) == tnmean(-Inf, 0, 0, 1) ≈ -√(2/π)
    @test tnvar(0, Inf) == tnvar(0, Inf, 0, 1) ≈ 1 - 2/π
    @test tnvar(-Inf, 0) == tnvar(-Inf, 0, 0, 1) ≈ 1 - 2/π
end
